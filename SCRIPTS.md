# NPM Scripts Documentation

## Development Scripts

### `npm run backend-dev`
**Что делает:** Запускает TypeScript сервер в режиме watch с автоматическим перезапуском.

**Зачем:**
- Компилирует `.ts` файлы в реальном времени
- Перезапускает сервер при любых изменениях в `src/server`
- Позволяет видеть ошибки сразу во время разработки

**Используемые инструменты:**
- `tsx` - быстрый TypeScript runtime (вместо отдельных `tsc` + `node`)
- `--watch` - режим отслеживания файлов

**Пример использования:**
```bash
npm run backend-dev
```

---

### `npm run frontend-dev`
**Что делает:** Запускает Parcel в режиме watch для клиентской части.

**Зачем:**
- Отслеживает изменения в HTML, CSS, JS/TS файлов клиента
- Автоматически пересобирает бандлы
- Hot Module Replacement (HMR) для быстрой переподгрузки в браузере
- Стартует dev-сервер на порту 1234

**Используемые инструменты:**
- `parcel` - модульный бандлер с встроенным dev-сервером
- `--dist-dir dist/public` - указывает куда сохранять готовые файлы

**Пример использования:**
```bash
npm run frontend-dev
```

---

### `npm run dev`
**Что делает:** Запускает backend и frontend одновременно в одном терминале.

**Зачем:**
- Удобно для разработки - видны логи обоих процессов
- Использует `concurrently` для параллельного запуска
- При Ctrl+C останавливает оба процесса одновременно
- Цветные префиксы `[BACKEND]` (cyan) и `[FRONTEND]` (magenta) для различия логов

**Что происходит внутри:**
1. Запускает `tsx watch src/server/index.ts` - компилирует и перезапускает сервер
2. Запускает `parcel watch ...` - пересобирает клиентскую часть
3. `--kill-others-on-exit` - при остановке одного процесса останавливает и другой

**Пример использования:**
```bash
npm run dev
```

**Возможные проблемы:**
- Если порты заняты - используйте предварительно `npm run dev:clean`

---

### `npm run dev:clean`
**Что делает:** Убивает все процессы на портах 3000 (backend) и 1234 (frontend).

**Зачем:**
- Когда предыдущий `npm run dev` не завершился корректно
- Очищает "зависшие" процессы перед новым запуском
- Предотвращает ошибку "Port already in use"

**Как работает:**
- `lsof -ti:3000` - находит процесс на порту 3000
- `xargs kill -9` - убивает найденный процесс

**Пример использования:**
```bash
npm run dev:clean
```

---

### `npm run dev:log`
**Что делает:** Запускает dev режим и одновременно сохраняет все логи в файл.

**Зачем:**
- Удобно для отладки - есть полный лог всей сессии разработки
- Файл создается с датой-временем: `dev-20260214-101530.log`
- `tee` - одновременно выводит в терминал и пишет в файл

**Пример использования:**
```bash
npm run dev:log
# Создаст файл dev-20260214-101530.log
```

---

## Build Scripts

### `npm run backend-build`
**Что делает:** Компилирует TypeScript сервера в JavaScript.

**Зачем:**
- Преобразует `.ts` файлы в `.js` для запуска в production
- Результаты сохраняются в `dist/server/`
- Использует конфиг из `tsconfig.json`

**Используемые инструменты:**
- `tsc` - официальный TypeScript компилятор

**Пример использования:**
```bash
npm run backend-build
```

---

### `npm run frontend-build`
**Что делает:** Собирает клиентскую часть для production.

**Зачем:**
- Минификация и оптимизация кода
- Tree-shaking - удаление неиспользуемого кода
- Генерирует оптимизированные бандлы в `dist/public/`

**Используемые инструменты:**
- `parcel build` - production режим Parcel

**Пример использования:**
```bash
npm run frontend-build
```

---

### `npm run build`
**Что делает:** Собирает backend И frontend последовательно (сначала backend, потом frontend).

**Зачем:**
- One-shot команда для полной сборки приложения
- Backend собирается ПЕРЕД frontend (важно!)
- Использует `&&` - если backend соберется с ошибкой, frontend собираться не будет

**Как работает:**
1. `npm run backend-build` - компилирует TS сервера
2. **ЗАТЕМ** `npm run frontend-build` - собирает клиент

**Пример использования:**
```bash
npm run build
```

---

## Production Scripts

### `npm start`
**Что делает:** Полный production pipeline - собрать всё и запустить сервер.

**Зачем:**
- Используется при развертывании на production сервере
- Сначала собирает оба части приложения
- Потом запускает скомпилированный сервер на `http://localhost:3000`

**Как работает:**
1. `npm run build` - полная сборка (backend → frontend)
2. `node dist/server/index.js` - запускает скомпилированный сервер

**Пример использования:**
```bash
npm start
```

---

## Code Quality Scripts

### `npm run lint`
**Что делает:** Проверяет код на ошибки и стиль (ESLint).

**Зачем:**
- Находит потенциальные баги
- Проверяет соответствие стилю кодирования
- Не меняет код, только сообщает об ошибках

**Пример использования:**
```bash
npm run lint
```

---

### `npm run lint:fix`
**Что делает:** Автоматически исправляет ошибки линтера, которые можно исправить.

**Зачем:**
- Экономит время - не нужно вручную исправлять
- Приводит код к единому стилю проекта

**Пример использования:**
```bash
npm run lint:fix
```

---

### `npm run format`
**Что делает:** Форматирует код через Prettier (отступы, кавычки, точки с запятой и т.д.).

**Зачем:**
- Унифицирует форматирование всего проекта
- Делает код более читаемым

**Пример использования:**
```bash
npm run format
```

---

### `npm run format:check`
**Что делает:** Проверяет соответствие кода форматированию Prettier БЕЗ изменений.

**Зачем:**
- Используется в CI/CD для проверки перед коммитом
- Не меняет файлы, только показывает что не правильно

**Пример использования:**
```bash
npm run format:check
```

---

## Quick Reference

| Команда | Для чего | Используй когда |
|---------|----------|-----------------|
| `npm run dev` | Dev режим оба процесса | Разработка, основная работа |
| `npm run dev:fresh` | Clean start | Порты заняты |
| `npm run dev:clean` | Очистить порты | Нужно убить зависшие процессы |
| `npm run dev:log` | Dev + сохранить логи | Отладка сложной проблемы |
| `npm run backend-dev` | Только сервер | Если фронт не нужен |
| `npm run frontend-dev` | Только клиент | Если сервер работает |
| `npm run build` | Собрать всё | Перед `npm start` |
| `npm start` | Production | Запуск на сервере |
| `npm run lint` | Проверить код | Перед коммитом |
| `npm run format` | Отформатировать | Перед коммитом |

---

## Внутренние Компоненты

### MongoDB
- **Тип:** In-Memory база (сбрасывается при перезапуске)
- **Зачем:** Быстрая разработка без настройки реальной БД
- **Доступ:** MongoDB Compass на `mongodb://127.0.0.1:XXXXX/`
- **Фикстуры:** 3 тестовых пользователя загружаются автоматически

### TypeScript Компиляция
- **Server:** `tsx watch` (быстрый runtime)
- **Build:** `tsc` (стандартный компилятор)
- **Config:** `tsconfig.json` - включает только `src/server/**/*.ts`

### Frontend Сборка
- **Dev:** Parcel watch с HMR
- **Build:** Parcel build с минификацией
- **Entry:** `src/client/index.html`
- **Output:** `dist/public/`

### Graceful Shutdown
- При Ctrl+C: закрывается HTTP сервер → Mongoose → In-Memory MongoDB
- **Зачем:** Чистое завершение без потери данных и ошибок
